{# app/templates/estoque/produtos.html #}

{# Indica que este template herda do base.html #}
{% extends 'base.html' %}

{# Define o conteúdo do bloco 'title' #}
{% block title %}{{ title }}{% endblock %}

{# Adiciona CSS específico para DataTables #}
{% block styles %}
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    {# Opcional: CSS do DataTables integrado com Bootstrap #}
    {# <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css"> #}
{% endblock %}

{# Define o conteúdo do bloco 'content' #}
{% block content %}
    <h1>{{ title }}</h1>

    {# Adicionar um botão para adicionar novo produto futuramente #}
    {# <a href="{{ url_for('estoque.adicionar_produto') }}" class="btn btn-primary mb-3">Adicionar Novo Produto</a> #}


    <table id="produtosTable" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>Código</th>
                <th>Nome</th>
                <th>Categoria</th>
                <th>Fornecedor</th>
                <th>Preço</th>
                <th>Qtd Estoque</th>
                <th>Estoque Mínimo</th>
                <th>Última Atualização</th>
                <th>Ações</th> {# Coluna para botões de Editar/Excluir #}
            </tr>
        </thead>
        <tbody>
            {# Loop através da lista de produtos passada pela rota #}
            {% for produto in produtos %}
                {# Adiciona uma classe de alerta se o estoque for baixo #}
                <tr {% if produto.quantity_in_stock <= produto.minimum_stock %}class="table-warning"{% endif %}>
                    <td>{{ produto.code }}</td>
                    <td>{{ produto.name }}</td>
                    {# Acessa o nome da categoria através do relacionamento #}
                    <td>{{ produto.category.name if produto.category else 'N/A' }}</td>
                    {# Acessa o nome do fornecedor através do relacionamento #}
                    <td>{{ produto.supplier.name if produto.supplier else 'N/A' }}</td>
                    {# Formata o preço como moeda, usando Decimal para precisão #}
                    <td>R$ {{ "%.2f"|format(produto.price) }}</td>
                    <td>{{ produto.quantity_in_stock }}</td>
                    <td>{{ produto.minimum_stock }}</td>
                    {# Formata a data #}
                    <td>{{ produto.last_updated.strftime('%d/%m/%Y %H:%M') }}</td>
                    <td>
                        {# Botões de Ação (Editar/Excluir) - apenas esqueletos por enquanto #}
                        <a href="{{ url_for('estoque.editar_produto', product_id=produto.id) }}" class="btn btn-sm btn-outline-primary">Editar</a>
                        {# O botão de excluir geralmente usa um formulário POST para segurança #}
                        {# <form action="{{ url_for('estoque.excluir_produto', product_id=produto.id) }}" method="post" style="display:inline;"> #}
                        {#     <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Tem certeza que deseja excluir este produto?');">Excluir</button> #}
                        {# </form> #}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{# Adiciona JS específico para jQuery (requerido pelo DataTables) e DataTables #}
{% block scripts %}
    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
    {# Opcional: JS do DataTables integrado com Bootstrap #}
    {# <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script> #}

    <script>
        $(document).ready( function () {
            // Inicializa o DataTables na tabela com o ID 'produtosTable'
            $('#produtosTable').DataTable({
                 // Configurações opcionais aqui
                 "language": {
                     "url": "//cdn.datatables.net/plug-ins/1.11.5/i18n/Portuguese-Brasil.json" // Opcional: Tradução para Português
                 }
            });
        } );
    </script>
{% endblock %}